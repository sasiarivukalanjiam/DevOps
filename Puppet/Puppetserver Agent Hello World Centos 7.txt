***********************************************************************
CentOS  release 7.4 Puppet Server - Agent setup and simple Hello World 
***********************************************************************

Puppet - Server
===============
(Needs to execute everything with #shell)
sudo su

hostnname -f
<FQDN>

cat /etc/hosts
<<Puppet-Server-IP>>  puppet  <FQDN>

yum -y update

rpm -Uvh https://yum.puppet.com/puppet5/puppet5-release-el-7.noarch.rpm

yum -y update

yum install puppetserver

vi /etc/profile
PATH=/opt/puppetlabs/bin:$PATH
export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL

source /etc/profile

env

cat puppet.conf
# This file can be used to override the default puppet settings.
# See the following links for more details on what settings are available:
# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html
# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html
# - https://docs.puppetlabs.com/puppet/latest/reference/configuration.html
[master]
vardir = /opt/puppetlabs/server/data/puppetserver
logdir = /var/log/puppetlabs/puppetserver
rundir = /var/run/puppetlabs/puppetserver
pidfile = /var/run/puppetlabs/puppetserver/puppetserver.pid
codedir = /etc/puppetlabs/code

cd /etc/puppetlabs/code/environments/production/modules
puppet module generate  helloworld-helloworld
cd helloworld/manifests/

cat init.pp
class helloworld {
notify { 'hello, world!': }
}

cat motd.pp
 class helloworld::motd {
    file { '/etc/motd':
    owner  => 'root',
    group  => 'root',
    mode    => '0644',
    content => "hello, world!\n",
    }
 }


cat /etc/puppetlabs/code/environments/production/manifests/site.pp
node default {
 class { 'helloworld': }
 class { 'helloworld::motd': }
 }


Puppet -Agent
=============
(Needs to execute everything with #shell)
sudo su

yum -y update

rpm -Uvh https://yum.puppet.com/puppet5/puppet5-release-el-7.noarch.rpm

yum -y update

yum install puppet-agent

vi /etc/profile
PATH=/opt/puppetlabs/bin:$PATH
export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL
source /etc/profile

env

ping puppet

vi /etc/hosts
<<Puppet-Server-IP>> puppet

/opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true

/opt/puppetlabs/bin/puppet agent --test
Exiting; no certificate found and waitforcert is disabled


Puppet - Server(Contd..)
=========================

/opt/puppetlabs/bin/puppet cert list

/opt/puppetlabs/bin/puppet cert sign <<Puppet-Agent-Host-Name>>

/opt/puppetlabs/bin/puppet cert list --all 


Puppet -Agent(Contd..)
======================

puppet agent -t
Info: Using configured environment 'production'
...
Notice: Applied catalog in x.yz seconds

cat /etc/motd
hello, world!


Reference
=========
 
Repo :https://puppet.com/docs/puppet/5.5/puppet_platform.html
Server :https://puppet.com/docs/puppetserver/5.1/install_from_packages.html
Agent :https://puppet.com/docs/puppet/5.3/config_important_settings.html
Example :https://puppet.com/docs/puppet/4.9/quick_start_helloworld.html